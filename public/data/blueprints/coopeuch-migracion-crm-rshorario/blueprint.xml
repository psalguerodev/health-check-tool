<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
    xmlns:cm="http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.0.0"
    xmlns:cxf="http://camel.apache.org/schema/blueprint/cxf"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.osgi.org/xmlns/blueprint/v1.0.0 https://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd                            http://camel.apache.org/schema/blueprint http://camel.apache.org/schema/blueprint/camel-blueprint.xsd">
    <cm:property-placeholder id="propertyLocal"
        persistent-id="wshorariocrm" placeholder-prefix="[{" placeholder-suffix="}]"/>
    <bean class="cl.coopeuch.integracion.utilidad.util.RouteFacade" id="beanRouteFacade"/>
    <!--Servicios -->
    <cxf:cxfEndpoint address="/crm/WSHorario" id="fromWsHorarioSoap"
        loggingFeatureEnabled="true"
        serviceClass="cl.coopeuch.crm.wshorario.WSHorarioSoap" wsdlURL="etc/wsdl/WSHorario.asmx.wsdl"/>
    <cxf:rsServer address="/crm/RSHorario" id="fromWsHorarioRest"
        loggingFeatureEnabled="true" serviceClass="cl.coopeuch.integracion.utilidad.rest.HorarioCRMRest"/>
    <!--Cliente proxy-->
    <cxf:cxfEndpoint address="[{crm.proxy.horario.endpoint}]"
        id="toEndpointWsHorario" loggingFeatureEnabled="true"
        serviceClass="cl.coopeuch.crm.wshorario.WSHorarioSoap" wsdlURL="etc/wsdl/WSHorario.asmx.wsdl"/>
    <camelContext id="servicio-crm-horario" xmlns="http://camel.apache.org/schema/blueprint">
        <route id="soap-inicio" streamCache="true">
            <from id="horarioFrom" uri="cxf:bean:fromWsHorarioSoap?dataFormat=RAW"/>
            <removeHeaders id="horarioRemoveHeaders" pattern="CamelHttp*"/>
            <to id="horarioTo" uri="cxf:bean:toEndpointWsHorario?dataFormat=RAW"/>
        </route>
        <route id="rest-inicio" streamCache="true">
            <from id="inicioRestFrom" uri="cxfrs:bean:fromWsHorarioRest"/>
            <choice id="fromOperation">
                <when id="whenVerificaHorarioHabil">
                    <simple>${header.operationName} == 'verificaHorarioHabil'</simple>
                    <unmarshal id="unmarshalVerificaHorarioHabil">
                        <json include="NON_NULL" library="Jackson" unmarshalTypeName="cl.coopeuch.crm.wshorario.VerificaHorarioHabil"/>
                    </unmarshal>
                    <bean id="verificaHorarioHabilRequest"
                        method="verificaHorarioHabilRest" ref="beanRouteFacade"/>
                    <to id="verificaHorarioHabilTo" uri="cxf:bean:toEndpointWsHorario"/>
                    <marshal id="marshalVerificaHorarioHabilResponse">
                        <json include="NON_NULL" library="Jackson" unmarshalTypeName="cl.coopeuch.crm.wshorario.VerificaHorarioHabilResponse"/>
                    </marshal>
                </when>
                <when id="whenObtieneConfiguracionHorario">
                    <simple>${header.operationName} == 'obtieneConfiguracionHorario'</simple>
                    <unmarshal id="unmarshalObtieneConfiguracionHorario">
                        <json include="NON_NULL" library="Jackson" unmarshalTypeName="cl.coopeuch.crm.wshorario.ObtieneConfiguracionHorario"/>
                    </unmarshal>
                    <bean id="obtieneConfiguracionHorarioRequest"
                        method="obtieneConfiguracionHorarioRest" ref="beanRouteFacade"/>
                    <to id="obtieneConfiguracionHorarioTo" uri="cxf:bean:toEndpointWsHorario"/>
                    <marshal id="marshalObtieneConfiguracionHorarioResponse">
                        <json include="NON_NULL" library="Jackson" unmarshalTypeName="cl.coopeuch.crm.wshorario.ObtieneConfiguracionHorarioResponse"/>
                    </marshal>
                </when>
            </choice>
        </route>
    </camelContext>
</blueprint>
